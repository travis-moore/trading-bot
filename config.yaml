# Swing Trading Bot Configuration

# Interactive Brokers Connection
ib_connection:
  host: "127.0.0.1"
  port: 7497  # TWS live=7497, paper=7497, Gateway live=7497, paper=4002
  client_id: 1
  sequential_scanning: true  # Set to true if hitting market data limits (e.g. only 3 symbols working)

# Trading symbols to monitor
# symbols:
#   - "NVDA"
#   - "AAPL"
#   - "TSLA"
#   # Add more symbols as needed

# Liquidity Analyzer Settings
liquidity_analysis:
  liquidity_threshold: 500        # Lowered from 20000 to catch normal liquidity
  zone_proximity: 0.50            # Increased proximity window
  imbalance_threshold: 0.6       # Order imbalance threshold (0-1)
  num_levels: 50                  # Number of order book levels to analyze

# Trading Rules - Pattern confidence thresholds
trading_rules:
  rejection_support_confidence: 0.65    # Bounce off support
  breakout_up_confidence: 0.70          # Strong buying pressure
  rejection_resistance_confidence: 0.65  # Rejection at resistance
  breakout_down_confidence: 0.70        # Strong selling pressure

# Risk Management
risk_management:
  max_position_size: 2000        # Maximum dollar amount per position
  max_positions: 3               # Maximum concurrent positions
  position_size_pct: 0.02        # Position size as % of account (2%)
  profit_target_pct: 0.50        # Take profit at 50% gain
  stop_loss_pct: 0.30            # Stop loss at 30% loss
  trailing_stop_enabled: true    # Enable trailing stops
  trailing_stop_activation_pct: 0.10 # Start trailing after 10% profit
  trailing_stop_distance_pct: 0.05   # Trail by 5% from peak
  max_hold_days: 30              # Maximum days to hold position

# Order Management
order_management:
  use_bracket_orders: true       # Attach stop loss and take profit to buy orders
  order_timeout_seconds: 60      # Cancel unfilled orders after this time
  price_drift_threshold: 0.10    # Cancel if price drifts more than 10% from limit

# Option Selection
option_selection:
  min_dte: 14                    # Minimum days to expiration
  max_dte: 45                    # Maximum days to expiration
  call_strike_pct: 1.02          # Call strike: 2% OTM
  put_strike_pct: 0.98           # Put strike: 2% OTM

# Bot Operation
operation:
  scan_interval: 5              # Seconds between scans
  market_data_refresh: 5         # Seconds between depth data updates
  enable_paper_trading: true     # Use paper trading account
  log_level: "INFO"              # DEBUG, INFO, WARNING, ERROR
  data_collection_mode: true    # Log detailed market data to CSV for debugging

# Notifications
notifications:
  # Create a webhook in Discord: Server Settings > Integrations > Webhooks
  discord_webhook: "https://discord.com/api/webhooks/1469522939698479177/hO4AcIvyBuWyWqaDFOTMdVUiSJzjdmGOlXkW3GIb7BJebkL2IP3YWPRFfYxAQADageIJ"            # Paste URL here to enable notifications

# Market Regime Settings
market_regime:
  high_chaos_vix_threshold: 30.0  # VIX level that triggers High Chaos
  high_chaos_vix_change_pct: 0.20 # 20% spike in VIX
  high_chaos_spy_vol_pct: 0.02    # 2% daily realized volatility in SPY
  bull_trend_vix_threshold: 20.0  # Max VIX for Bull Trend
  range_bound_vix_min: 15.0       # Min VIX for Range Bound
  range_bound_vix_max: 25.0       # Max VIX for Range Bound

# Safety Features
safety:
  require_manual_approval: false  # Require approval before trades
  max_daily_loss: 500            # Max loss per day (dollars)
  trading_hours_only: true       # Only trade during market hours
  emergency_stop: false          # Emergency stop all trading

strategies:
  # Multiple swing trading instances with different parameters
  # Each strategy instance has its own:
  #   - budget: Max capital for this strategy (committed on entry, released on exit)
  #   - max_positions: Max concurrent positions for this strategy instance
  # Losses increase drawdown, wins recover it up to budget cap
  swing_conservative:
    type: swing_trading
    enabled: true
    budget: 2000                    # Max budget for this strategy ($)
    symbols: ["NVDA", "AAPL", "TSLA", "QQQ", "XSP"] # Monitor these symbols
    max_positions: 2                # Max concurrent positions
    level_confirmation_minutes: 1   # Reduced from 5m to 1m for faster detection
    exclusion_zone_pct: 0.001       # Reduced from 0.5% to 0.1% to see closer levels
    zone_proximity_pct: 0.005       # 0.5% proximity (wider)
    min_confidence: 0.75            # Higher confidence required
    zscore_threshold: 3.5           # Stricter level filtering
    allowed_regimes: ["bull_trend", "range_bound"] # Only trade in favorable regimes
    min_sector_rs: 0.0              # Only trade if sector is outperforming SPY (positive slope)
    # Historical Bounce Detection
    historical_bounce_enabled: true
    historical_lookback_days: 30    # Days of historical data
    # Bar sizes: '1 min', '5 mins', '15 mins', '30 mins', '1 hour', '1 day'
    historical_bar_size: '15 mins'
    swing_window: 5                 # Bars on each side for swing detection
    bounce_proximity_pct: 0.001     # 0.1% tolerance for clustering
    min_bounces: 2                  # Min tests to form a level
    decay_type: 'linear'            # 'linear' or 'exponential'
    linear_decay_days: 30           # Days to full decay
    power_level_proximity_pct: 0.005  # 0.5% - historical + depth alignment
    power_level_confidence_boost: 0.15
    # Performance Feedback - adjusts confidence based on recent results
    # Symbol Overrides
    symbol_overrides:
      NVDA:
        zone_proximity_pct: 0.008   # Wider zones for NVDA due to volatility
    performance_feedback_enabled: true
    performance_lookback_days: 14   # Days to consider for win rate/P&L
    min_trades_for_feedback: 5      # Min trades before adjusting confidence

  swing_aggressive:
    type: swing_trading
    enabled: true
    budget: 1500                    # Smaller budget for aggressive strategy
    symbols: ["NVDA", "TSLA", "QQQ", "XSP"]       # Only trade these volatile stocks
    daily_loss_limit: 200.0         # Stop this strategy if it loses $200 today
    max_positions: 2                # Max concurrent positions
    level_confirmation_minutes: 1   # Faster confirmation
    exclusion_zone_pct: 0.001       # See closer levels
    zone_proximity_pct: 0.003       # 0.3% proximity (tighter)
    min_confidence: 0.65            # Lower confidence threshold
    zscore_threshold: 2.5           # More levels considered
    allowed_regimes: ["bull_trend", "bear_trend", "range_bound"]
    # Historical Bounce Detection - more aggressive settings
    historical_bounce_enabled: true
    historical_lookback_days: 20    # Shorter lookback (more recent data)
    historical_bar_size: '15 mins'
    swing_window: 3                 # Tighter swing detection
    bounce_proximity_pct: 0.0015    # Wider clustering
    min_bounces: 2
    decay_type: 'exponential'       # Faster decay
    exponential_half_life_days: 10
    power_level_proximity_pct: 0.007  # Wider alignment
    power_level_confidence_boost: 0.20  # Bigger boost
    # Performance Feedback - more sensitive for aggressive strategy
    performance_feedback_enabled: true
    performance_lookback_days: 7    # Shorter window for faster adaptation
    min_trades_for_feedback: 3
    max_confidence_penalty: 0.25    # Larger penalty for poor performance

  # Multiple scalping instances
  scalp_quick:
    type: scalping
    enabled: true
    symbols: ["NVDA", "TSLA", "QQQ", "XSP"]       # High volatility symbols for scalping
    budget: 1000                    # Tighter budget for quick scalps
    daily_loss_limit: 150.0         # Stop scalping if down $150
    max_positions: 1                # Scalping = one position at a time
    imbalance_entry_threshold: 0.7
    max_ticks_without_progress: 3   # Quick exit
    allowed_regimes: ["bull_trend", "bear_trend", "range_bound", "high_chaos"]
    # Performance Feedback
    performance_feedback_enabled: true
    performance_lookback_days: 7    # Shorter window for scalping
    min_trades_for_feedback: 10     # Scalping has more trades
    pnl_baseline: 20.0              # Lower baseline for scalping profits

  scalp_patient:
    type: scalping
    enabled: true
    symbols: ["NVDA", "AAPL", "QQQ", "XSP"]       # Slightly more stable symbols
    budget: 1500
    max_positions: 1                # Scalping = one position at a time
    imbalance_entry_threshold: 0.8  # Higher threshold
    max_ticks_without_progress: 7   # More patience
    allowed_regimes: ["bull_trend", "bear_trend", "range_bound"]
    # Performance Feedback
    performance_feedback_enabled: true
    performance_lookback_days: 10
    min_trades_for_feedback: 8
    pnl_baseline: 25.0

  # Momentum Strategies
  vix_orb_1:
    type: vix_momentum_orb
    enabled: true
    symbols: ["XSP", "QQQ"]
    budget: 2000
    orb_minutes: 15
    target_profit: 300.0
    contract_cost_basis: 150.0
    vix_symbol: 'VIX'
    allowed_regimes: ["bull_trend", "bear_trend", "high_chaos"]

  # Options / Spread Strategies
  bull_put_spread_1:
    type: bull_put_spread
    enabled: true
    symbols: ["AAPL", "NVDA", "QQQ", "XSP"]
    budget: 2000
    max_positions: 2
    zone_proximity_pct: 0.005
    rejection_support_confidence: 0.70 # Specific param for Bull Put (Support Rejection)
    allowed_regimes: ["bull_trend", "range_bound"]

  bear_put_spread_1:
    type: bear_put_spread
    enabled: true
    symbols: ["TSLA", "NVDA", "QQQ", "XSP"]
    budget: 2000
    max_positions: 2
    zone_proximity_pct: 0.005
    absorption_confidence: 0.70     # Specific param for Bear Put (Breakout Down)
    allowed_regimes: ["bear_trend"]

  long_put_1:
    type: long_put
    enabled: true
    symbols: ["TSLA", "QQQ", "XSP"]
    budget: 1500
    max_positions: 2
    zone_proximity_pct: 0.005
    absorption_confidence: 0.75     # Specific param for Long Put (Breakout Down)
    allowed_regimes: ["bear_trend", "high_chaos"]

  iron_condor_1:
    type: iron_condor
    enabled: true
    symbols: ["AAPL", "MSFT", "QQQ", "XSP"]       # Stable stocks for Range Bound strategies
    budget: 2500
    max_positions: 2
    zone_proximity_pct: 0.005
    min_confidence: 0.80
    allowed_regimes: ["range_bound"]
